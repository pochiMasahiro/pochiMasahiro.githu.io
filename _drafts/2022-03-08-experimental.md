---
layout: post
title: 実験実習課題:オペアンプ回路
date: 2022-03-08 03:02
category: 
author: M. Fukuoka
tags: []
summary: 
---

# 実験日程

- 1週目では、反転増幅回路の直流(DC)及び交流(AC)特性の実験を行う。
- 2週目では、反転増幅回路の入出力インピーダンス特性の実験を行う。

# 実験目的

オペアンプを用いた反転増幅回路を例として、

- オペアンプの電気的特性を示すパラメータ
- オペアンプの基本的な使用法

の2つを実験を通じて理解することを目指す。

# オペアンプの原理

## オペアンプの動作と回路図記号

オペアンプとはOperational Amplifier (演算増幅器) の略語である。演算の名の通り、四則演算や微分・積分の演算を行う回路、信号の増幅、インピーダンスの変換など多彩な回路が実現できる集積回路である。

オペアンプの回路は図[@fig:label]に示される形をしている。1つのオペアンプは5つの端子から構成されている。左側の2つの端子は入力端子であり、それぞれ正相入力端子、逆相入力端子と呼ばれる。三角形の頂点に接続される右側の端子は出力端子である。上下に向かって伸びる2つの端子は電源端子であり、一般的に上部は正電源が接続され、下部は負電源の端子が接続される。電源端子は省略されることも場合は図？(b)のように示される。

![opamp](/assets/opamp/opamp.png "オペアンプの回路図記号"){#fig:symbol}

オペアンプは、「2つの入力端子の電圧差をオープンループゲイン倍に増幅して出力する」、という動作をする。式で表すと、

$$
\begin{equation}
V_o = A(V_+ - V_-)
\end{equation}
$$

となる。ここで、 $$A$$ はオープンループゲインと呼ばれる、オペアンプだけのゲインである。一般にオープンループゲイン $$A$$ は非常に大きく、100 dB以上を有する。

オペアンプそのものは、このように単純な動作しかしないが、帰還回路(出力を入力に戻す回路)を適切に設計することで、多彩な機能を有する回路を容易に実現できる。逆に言うとオペアンプを用いた回路というのは、そのほとんどが帰還回路により実現される。

## オペアンプの特性

オペアンプの特性を表す重要なパラメータとして以下の5つが挙げられる。ここでは、オペアンプの性質を理解するものとして理想オペアンプというものを考えて、これらのパラメータを説明する。

### 差動利得

オープンループゲインのことである。2つ入力の差分をどの程度増幅するのかを表す。理想オペアンプでは無限大となる。

### 同相利得

2つの入力端子に同じ信号が入力されたときに、その信号がどの程度増幅されるのかを表す。2つの入力端子に同じ信号が入れば、その差分は0になるので、理想オペアンプではゼロになる。

### 入力インピーダンス

オペアンプの入力端子は、入力の構造(バイポーラ、FET)にもよるが、ほとんど電流は流れないと考えることができ、メガオーム以上の入力インピーダンスを有する。理想オペアンプでは無限大として考える。

### 出力インピーダンス

オペアンプの出力端子に直列に存在するインピーダンスである。数百オーム程度の値を有する。理想オペアンプではゼロとして考える。

# オペアンプ回路

## オペアンプを用いた反転増幅回路

ここで用いるオペアンプとして、次のような条件を有する理想オペアンプであるとする。

1. オープンループゲイン $$A$$ は無限大
2. 入力インピーダンスは無限大
3. 出力インピーダンスはゼロ

以下、断りがなければ、その説明で用いるオペアンプは理想オペアンプを想定する。

図？はオペアンプを用いた反転増幅回路である。この回路について詳細に見ていく。オペアンプの逆相入力端子には抵抗 $$R_1$$を介して、入力 $$V_{in}$$ が接続され、また $$R_2$$ を介して出力 $$V_o$$ がフィードバックされている。

![inverted amp.](/assets/opamp/inverted_amp.png "オペアンプを用いた反転増幅回路")

### ゲインの計算

反転増幅回路全体のゲインを求める。オペアンプの出力 $$V_o$$ を求めるために、それぞれの入力端子の電位を求める。正相入力端子はGndに接続されているので、電位はゼロである。逆相入力端子の電位を求める。このとき、オペアンプの入力端子に電流は流れない(入力インピーダンス無限大)ため、入力端子から出力端子に至るまでの回路は次の図のようになる。

![partial](/assets/opamp/partial.png "反転増幅回路の入力から出力までの分圧回路")
この回路は分圧回路になっているので、反転入力端子の電位 $$V_-$$ は次のように表すことができる。

$$
\begin{equation}
V_- = \frac{R_1}{R_1+R_2}\left(V_o - V_{in}\right) + V_{in}
\end{equation}
$$

逆相入力端子の電位$$V_-$$ を、オペアンプの入出力の関係 $$V_o = A(V_+ - V_-)$$ に代入すると、次のように表される。

$$
\begin{aligned}
V_o & = -AV_- \\
& = -A \left\{\left(V_o - V_{in} \right) \frac{R_1}{R_1 + R_2} + V_{in}\right\} \\
\end{aligned}
$$

この式を $$V_o$$ について解くことで、

$$
\begin{equation}
V_o = \frac{\frac{AR_1}{R_1+R_2} - A}{1 + \frac{AR_1}{R_1+R_2}} V_{in}
\end{equation}
$$

となる。オペアンプのオープループゲインは無限大なので、 $$A \rightarrow \infty$$ の極限を考えると、

$$
\begin{aligned}
V_o & = \lim_{A \rightarrow \infty}{\frac{\frac{AR_1}{R_1+R_2} - A}{1 + \frac{AR_1}{R_1+R_2}} V_{in}} \\
& = \lim_{A \rightarrow \infty}{\frac{\frac{R_1}{R_1+R_2} - 1}{\frac{1}{A} + \frac{R_1}{R_1+R_2}} V_{in}} \\
& = -\frac{R_2}{R_1} V_{in}
\end{aligned}
$$

となり、反転増幅回路全体のゲインは $$-\frac{R_2}{R_1}$$ となる。

### バーチャルショート

バーチャルショート(仮想短絡)とは、オペアンプの入力端子 $$V_+$$ と $$V_-$$ が短絡(ショート)されたように等しい電圧を示すことを言う。非常に高いオープンループゲインを有する差動増幅回路を負帰還回路で使用するときに現れる性質のことである。「ショート」という言葉を用いているが、あくまでも電位が等しくなるだけで、電流は流れない。

負帰還のオペアンプ回路は、バーチャルショートを用いることで、先程のような極限を考えるなどの操作を一切せずに非常に簡単に計算することができるようになる。先程と同じ反転増幅回路を、バーチャルショートを用いて計算してみる。

バーチャルショートを用いる場合は、増幅回路を流れる電流を考えると計算しやすいため、図に示すように電流$$I_1$$を考える。バーチャルショートを用いると、 $$V_+$$ がGndに接続されているため、

$$
\begin{equation}
V_- = V_+ = 0
\end{equation}
$$

となる。 $$R_1$$ に流れる電流 $$I_1$$ は、 $$V_- = 0$$ なので

$$
\begin{aligned}
I_1 &= \frac{V_{in} - V_-}{R_1} \\
&= \frac{V_{in}}{R_1}
\end{aligned}
$$

となる。オペアンプの入力端子には電流は流れないので、 $$I_1$$ はすべて抵抗 $$R_2$$ に流れる。出力電圧 $$V_o$$ は帰還抵抗 $$R_2$$ を介して $$V_-$$ 端子に接続されているので、

$$
\begin{aligned}
V_o - V_- & = -R_2I_1 \\
V_o & = -R_2 I_1
\end{aligned}
$$

と表される。電流 $$I_1$$ を代入することで、

$$
\begin{equation}
V_o = -\frac{R_2}{R_1} V_{in}
\end{equation}
$$

となる。

![virtual_short](/assets/opamp/virtual.png "バーチャルショートを用いたオペアンプ回路の計算")

このようにバーチャルショートを使うことで、オープンループゲインの極限を考えることなく容易に負帰還回路のゲインを求めることができる。バーチャルショートの性質を考えると、負帰還回路におけるオペアンプは、2つの入力端子が同電位となるように出力端子の電圧を調整する役割を担っていると考えることもできる。

## ボルテージフォロワ

図はボルテージフォロワと呼ばれる回路である。ボルテージフォロワとは、入力の電圧をそのまま出力するゲイン1のアンプである。この回路はインピーダンスの変換を行う役割を担っている。信号はオペアンプの入力端子に直接接続されている。これにより、非常に高いオペアンプの入力インピーダンスをそのまま活かすことができる。また、出力側のインピーダンスはオペアンプの出力インピーダンスになるので、非常に低い。出力インピーダンスの大きなセンサーなどの信号を高入力インピーダンスで受け、低出力インピーダンスに変換して出力することができる。

ボルテージフォロワの動作を考える。バーチャルショートの原理から、オペアンプの2つの入力端子は同電位となる。正相入力端子に信号が接続され、逆相入力端子は出力に接続されているので、この2つが同電位となる。したがって、ボルテージフォロワは入力信号をそのまま出力するゲイン1倍のアンプとなる。

![follower](/assets/opamp/voltage_follower.png "ボルテージフォロワ回路")


# 現実のオペアンプの電気特性

オペアンプ回路を理解するのに理想オペアンプを用いた近似は非常に有用である。しかし、現実のオペアンプでは、オープンループゲインは有限で、しかも、周波数特性を有する。また、入力インピーダンスも有限なので入力端子への電流の流入がある。入力差動回路を構成するトランジスタペアの誤差により生じるオフセットも存在する。ここでは理想オペアンプと現実のオペアンプの違いを整理し、現実のオペアンプのデータシートから代表的なパラメータの読み方を説明する。現実のオペアンプとして、今回の実験でも扱うTL074(Texas Instruments)を例として説明する。

図?にTL074の電気特性を示す。多くの特性が列挙されているが、この表からはインプットオフセット電圧/電流、インプットバイアス電流、CMRRを説明する。また、図?以外からオープンループゲイン、GB積を説明する。

![full_ch](/assets/opamp/datasheet/full_ch.png "TL074の電気的特性")

## オープンループゲイン

現実のオペアンプではオープンループゲインは90~150 dB程度になる。TL074では100 Hzで約95 dBである。図?はTL074のオープンループゲインを示している。図に示されるようにオープンループゲインは、周波数の増加に伴って低下していく。

![openloop](/assets/opamp/datasheet/openloop.png "TL074のオープンループゲイン")

## GB積

オペアンプを用いた増幅回路には、ゲイン(Gain)と周波数帯域幅(Bandwidth)の積(Gain bandwidth product)が一定になるという特性がある。このゲイン(G)と周波数帯域幅(B)の積をGB積という。図?はTL074を用いた増幅回路のゲインと周波数特性の関係を示している。 この図を用いてTL074のGB積を計算してみる。$$G=1$$ における帯域幅は約3MHz であるから3MHz である。次に$$G=10$$のGB積を考える。$$G=10$$における帯域幅は約300kHzである。したがって、GB積は3MHzである。このようにゲインと帯域幅は常に一定である。ここから、ゲインを大きく取ると使える帯域幅は減少し、帯域幅を大きく取ることでゲインは減少してしまう。

![GBproduct](/assets/opamp/datasheet/GBproducts.png "GB積")

## インプットバイアス電流

オペアンプの入力回路はトランジスタペアによる差動増幅回路で構成されている。バイポーラトランジスタを用いる入力回路では、ベース端子に電流を流さなければならない。これをインプットバイアス電流といい、入力インピーダンスが制限される要因になっている。これは一般に、nAオーダになる。入力回路がFETで構成されるオペアンプもある。この場合は、電圧でFETのゲート端子を駆動するので入力電流はほとんど流れない。しかし、全く電流が流れないわけではなく、ゲート端子からのリーク電流が存在し、リーク電流はpAオーダになる。

インプットバイアス電流は出力端子を0Vにしたときの入力端子に流入(流出)する電流として定義されている。

今回の実験で用いるTL074は入力端子はジャンクションFETで構成されるオペアンプである。インプットバイアス電流は図の$$I_{IB}$$であり、典型的(Typ.)な値は65pAである。

![input_bias](/assets/opamp/datasheet/input_bias.png "インプットバイアス電流")

## 入力オフセット電流

入力端子を構成する差動増幅回路のトランジスタペアの特性は揃っていることが期待される。しかし、完全に特性を揃えて製造することは困難なので、特性の差としてデータシートに定義されている。その中でも2つのインプットバイアス電流での差を入力オフセット電流として定義する。この電流が大きい場合、入力端子に接続される信号源の抵抗(信号源抵抗)に電流が流れることになり、入力端子間で電位差(次に説明するオフセット電圧)を生じる。

今回の実験で用いるTL074では$$I_{IO}$$として定義されており、典型値(Typ.)で5pAである。

![offset_current](/assets/opamp/datasheet/offset_i.png "入力オフセット電流")

## 入力オフセット電圧

負帰還回路を構成することで、オペアンプの2つの入力端子は同電位となる。このとき、信号が入力される端子を0Vとすることで出力端子も0V となることが期待される。しかし、実際のオペアンプでは入力端子を0Vとしても出力端子は0Vとならない。このとき、出力端子を0Vにするために必要な入力端子間の電位差を入力オフセット電圧という。増幅回路を構成した場合、入力オフセット電圧をゲイン倍した電圧が出力端子にオフセット電圧として加算されて現れる。入力端子を0Vにしたときの出力電圧を入力端子の電圧に換算して表す場合は、入力換算オフセット電圧とも呼ばれる。入力オフセット電圧でも入力換算オフセット電圧でも、両者とも同じ意味である。

今回の実験で用いるTL074では$$V_{IO}$$として定義されている。典型値(Typ.)は室温で3mVである。

![offset_voltage](/assets/opamp/datasheet/offset_v.png "入力オフセット電圧")

## CMRR (Common Mode Rejection Ratio)

コモンモードとは図?(a)のように、2つの信号線で同相となるような信号のことを意味する。それに対して、2つの信号線で互いに逆相となるような信号はディファレンシャルモードと言う(図?(b))。オペアンプは差動増幅回路なので、図?(b)のような互いに逆相となる信号の差分を増幅する。このような、差動信号は長距離伝送や高速信号の伝送に用いられている。差動信号線路に電磁的ノイズが発生する場合、差動信号線の両方に同じ信号が励起される。したがって、ノイズが同相信号として差動信号線に現れる(図)。オペアンプでは2つの入力端子で差分を計算するため、同相成分は除去される。CMRRとは、オペアンプで差動増幅回路を構成するときに、どの程度の同相成分を除去できるのかを意味する。完璧に特性の揃ったトランジスタで入力回路を構成できれば、オフセット電圧/電流も生じないため、同相信号を完全に除去できる。しかし、現実にはそのようなことは不可能なため、データシートにはCMRRとして同相信号がどの程度除去できるのかを定義している。

![mode](/assets/opamp/sidnal_mode.png "信号のモード")

![mode](/assets/opamp/noise.png "ノイズ")

今回の実験で用いるTL074では、CMRRとしてデータシートに記載されている。典型値(Typ.)は100dBであり、最低値は70dBが保証されている。

![CMRR](/assets/opamp/datasheet/cmrr.png "CMRR")

# 実験

## 1週目：反転増幅回路のDC/AC特性

### DC特性の測定

反転増幅回路のDC特性の測定を行う。

1. 図？に示す回路を結線する。
2. 入力電圧$$V_{in}$$を0-100mVの範囲で10点程度選び、その時の出力電圧$$V_o$$を記録せよ。
3. 表に示す抵抗の組み合わせについて2をすべて実行し、入力と出力の関係をグラフに図示せよ。

![inveted_dc](/assets/opamp/inverted_ex_dc.png "反転増幅回路のDC特性測定")

### AC特性の測定

反転増幅回路のAC特性の測定を行う。

1. 図？に示す回路を結線する。
2. 入力電圧$$V_{in}$$を10mVrmsに設定し、入力信号の周波数を10~100kHzの範囲で測定し、その時の出力電圧$$V_o$$を記録せよ。
3. 表に示す抵抗の組み合わせについて2をすべて実行し、周波数とゲインの関係をグラフに図示せよ。

![inveted_ac](/assets/opamp/inverted_ex_ac.png "反転増幅回路のAC特性測定")

## 2週目：反転増幅器の入出力インピーダンス

### 信号源インピーダンスによる影響の確認

増幅回路に入力される信号電圧は、信号源インピーダンス$$R_s$$と増幅回路の入力インピーダンス$$R_in$$により分圧された電圧になる。信号源インピーダンスを変化させて反転増幅回路に入力し、出力電圧を測定することで、反転増幅回路の入力インピーダンスを理解する。

1. 図のように結線する。
2. 電源装置の電圧$$V_1$$を100mVに設定する。
3. 信号源インピーダンスを模擬した抵抗$$R_s$$を10~10kΩの範囲で10点程度設定し、出力電圧を記録する。
4. 抵抗$$R_s$$と出力電圧の関係を図示せよ。

![impeadance](/assets/opamp/inverted_unfollower_dc.png "信号源インピーダンスの影響の確認")

### ボルテージフォロワ回路によるインピーダンス変換

反転増幅回路はオペアンプの入力端子に抵抗が接続されているため、オペアンプの特徴である高入力インピーダンスを活かすことができない。したがって、信号源インピーダンスの大きな信号源(センサーなど)を直接接続することが難しい。これを解決するためにボルテージフォロワー回路を用いる。反転増幅回路の前にボルテージフォロワ回路を接続し、入力インピーダンスが改善されることを確認する。

1. 図のように結線する。
2. 電源装置の電圧$$V_1$$を100mVに設定する。
3. 信号源インピーダンスを模擬した抵抗$$R_s$$を10~10kΩの範囲で10点程度設定し、出力電圧を記録する。
4. 抵抗$$R_s$$と出力電圧の関係を図示せよ。

![follower](/assets/opamp/inverted_follower_dc.png "ボルテージフォロワー回路によるインピーダンス変換")

### 大きな負荷の駆動

一般にオペアンプは数十mA程度しか出力できないので、大きな負荷を駆動することは困難である。この実験では負荷を大きくしながらオペアンプを駆動し、どの程度の負荷まで駆動できるのか確認する。

1. 図のように結線する。
2. 電源装置の電圧$$V_1$$を100mVに設定する。
3. 負荷抵抗$$R_L$$を10~1kΩの範囲で10点程度設定し、出力電圧を記録する。
4. 負荷抵抗$$R_L$$と出力電圧$$V_o$$の関係を図示せよ。

![load](/assets/opamp/load.png "負荷抵抗による影響の確認")

# 考察課題
